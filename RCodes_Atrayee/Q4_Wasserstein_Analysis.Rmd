---
title: "Q4-Wasserstein Analysis"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(igraph)
library(here)
library(tidyverse)
library (readr)
library (haven)
library (ggplot2)
library(transport)
library(plyr)
#if (!requireNamespace("BiocManager", quietly = TRUE))
#install.packages("BiocManager")
#BiocManager::install("waddR")
library(waddR)
```

## Fully Reduced:

```{r}
# Load The Data:
dt <- data.table::fread(here::here("data", "CGCS-Template.csv"))
proc_s1_full <- data.table::fread(here::here("dataQ3","FinalGraphs", "dfProcSeed1-Graph2FullyReduced.csv"))
proc_s3_full <- data.table::fread(here::here("dataQ3","FinalGraphs", "dfProcSeed3-Graph2FullyReduced.csv"))

```

```{r}
dt_network <- subset(dt, select = c(Source, Target, Weight))
proc_s1_full_network <- subset(proc_s1_full, select = c(Source, Target, Weight))
proc_s3_full_network <- subset(proc_s3_full, select = c(Source, Target, Weight))

dt_edgelist <- dt_network
dt_graph <- graph.data.frame(dt_edgelist, directed = TRUE)

proc_s1_full_edgelist <- proc_s1_full_network
proc_s1_full_graph <- graph.data.frame(proc_s1_full_edgelist, directed = TRUE)

proc_s3_full_edgelist <- proc_s3_full_network
proc_s3_full_graph <- graph.data.frame(proc_s3_full_edgelist, directed = TRUE)

```


# Wasserstein method:

```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = FALSE, remove.loops = FALSE)
proc_s1_full_graph2<-igraph::simplify(proc_s1_full_graph, remove.multiple = FALSE, remove.loops = FALSE)
proc_s3_full_graph2<-igraph::simplify(proc_s3_full_graph, remove.multiple = FALSE, remove.loops = FALSE)
```

# Degree:

```{r}
dt_degree <- as.matrix(degree(dt_graph2))
proc_s1_full_degree <- as.matrix(degree(proc_s1_full_graph2))
proc_s3_full_degree <- as.matrix(degree(proc_s3_full_graph2))
```


```{r}
wasserstein_metric(dt_degree, proc_s1_full_degree)
wasserstein_metric(dt_degree, proc_s3_full_degree)

# Testing based on Wasserstein Distance:
spec.output <- c("pval", "d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_degree, proc_s1_full_degree)[spec.output]
wasserstein.test(dt_degree, proc_s3_full_degree)[spec.output]
```

# Closeness:

```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = FALSE, remove.loops = FALSE)
proc_s1_full_graph2<-igraph::simplify(proc_s1_full_graph, remove.multiple = FALSE, remove.loops = FALSE)
proc_s3_full_graph2<-igraph::simplify(proc_s3_full_graph, remove.multiple = FALSE, remove.loops = FALSE)
```

```{r}
dt_closeness <- as.matrix(closeness(dt_graph2))
proc_s1_full_closeness <- as.matrix(closeness(proc_s1_full_graph2))
proc_s3_full_closeness <- as.matrix(closeness(proc_s3_full_graph2))
```

```{r}
# Testing based on Wasserstein Distance:
spec.output <- c("pval", "d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_closeness, proc_s1_full_closeness)[spec.output]
wasserstein.test(dt_closeness, proc_s3_full_closeness)[spec.output]
```

## Betweeness:

```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s1_full_graph2<-igraph::simplify(proc_s1_full_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s3_full_graph2<-igraph::simplify(proc_s3_full_graph, remove.multiple = TRUE, remove.loops = FALSE)
```

```{r}
dt_betweeness <- as.matrix(betweenness(dt_graph2))
proc_s1_full_betweeness <- as.matrix(betweenness(proc_s1_full_graph2))
proc_s3_full_betweeness <- as.matrix(betweenness(proc_s3_full_graph2))
```

```{r}
# Testing based on Wasserstein Distance:
spec.output <- c("pval", "d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_betweeness, proc_s1_full_betweeness)[spec.output]
wasserstein.test(dt_betweeness, proc_s3_full_betweeness)[spec.output]
```

## Eigen Centrality:

```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s1_full_graph2<-igraph::simplify(proc_s1_full_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s3_full_graph2<-igraph::simplify(proc_s3_full_graph, remove.multiple = TRUE, remove.loops = FALSE)
```

```{r}
dt_eigen_centrality <- as.matrix((eigen_centrality(dt_graph2))$vector)
proc_s1_full_eigen_centrality <- as.matrix((eigen_centrality(proc_s1_full_graph2))$vector)
proc_s3_full_eigen_centrality <- as.matrix((eigen_centrality(proc_s3_full_graph2))$vector)
```

```{r}
# Testing based on Wasserstein Distance:
spec.output <- c("pval","d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_eigen_centrality, proc_s1_full_eigen_centrality)[spec.output]
wasserstein.test(dt_eigen_centrality, proc_s3_full_eigen_centrality)[spec.output]
```

## Page Rank:

```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s1_full_graph2<-igraph::simplify(proc_s1_full_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s3_full_graph2<-igraph::simplify(proc_s3_full_graph, remove.multiple = TRUE, remove.loops = FALSE)
```

```{r}
dt_page_rank <- as.matrix((page.rank(dt_graph2))$vector)
proc_s1_full_page_rank <- as.matrix((page.rank(proc_s1_full_graph2))$vector)
proc_s3_full_page_rank <- as.matrix((page.rank(proc_s3_full_graph2))$vector)
```

```{r}
# Testing based on Wasserstein Distance:
spec.output <- c("pval","d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_page_rank, proc_s1_full_page_rank)[spec.output]
wasserstein.test(dt_page_rank, proc_s3_full_page_rank)[spec.output]
```


## - Fixed Communication for Extended: 
```{r}
# Load The Data:
dt <- data.table::fread(here::here("data", "CGCS-Template.csv"))
proc_s1 <- data.table::fread(here::here("dataQ3","FinalGraphs", "dfProcSeed1-FixedCommunication.csv"))
proc_s3 <- data.table::fread(here::here("dataQ3","FinalGraphs", "dfProcSeed1-FixedCommunication.csv"))
```

```{r}
dt_network <- subset(dt, select = c(Source, Target, Weight))
proc_s1_network <- subset(proc_s1, select = c(Source, Target, Weight))
proc_s3_network <- subset(proc_s3, select = c(Source, Target, Weight))

dt_edgelist <- dt_network
dt_graph <- graph.data.frame(dt_edgelist, directed = TRUE)

proc_s1_edgelist <- proc_s1_network
proc_s1_graph <- graph.data.frame(proc_s1_edgelist, directed = TRUE)

proc_s3_edgelist <- proc_s3_full_network
proc_s3_graph <- graph.data.frame(proc_s3_edgelist, directed = TRUE)
```

## Wasserstein Method:
```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = FALSE, remove.loops = FALSE)
proc_s1_graph2<-igraph::simplify(proc_s1_graph, remove.multiple = FALSE, remove.loops = FALSE)
proc_s3_graph2<-igraph::simplify(proc_s3_graph, remove.multiple = FALSE, remove.loops = FALSE)
```

## Degree:
```{r}
dt_degree <- as.matrix(degree(dt_graph2))
proc_s1_degree <- as.matrix(degree(proc_s1_graph2))
proc_s3_degree <- as.matrix(degree(proc_s3_graph2))
```

```{r}
# Testing based on Wasserstein Distance:
spec.output <- c("pval", "d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_degree, proc_s1_degree)[spec.output]
wasserstein.test(dt_degree, proc_s3_degree)[spec.output]
```

## Betweeness:

```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s1_graph2<-igraph::simplify(proc_s1_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s3_graph2<-igraph::simplify(proc_s3_graph, remove.multiple = TRUE, remove.loops = FALSE)

dt_betweeness <- as.matrix(betweenness(dt_graph2))
proc_s1_betweeness <- as.matrix(betweenness(proc_s1_graph2))
proc_s3_betweeness <- as.matrix(betweenness(proc_s3_graph2))
```

```{r}
# Testing based on Wasserstein Distance:
spec.output <- c("pval", "d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_betweeness, proc_s1_betweeness)[spec.output]
wasserstein.test(dt_betweeness, proc_s3_betweeness)[spec.output]
```

## Eigen Centrality:

```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s1_graph2<-igraph::simplify(proc_s1_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s3_graph2<-igraph::simplify(proc_s3_graph, remove.multiple = TRUE, remove.loops = FALSE)
```

```{r}
dt_eigen_centrality <- as.matrix((eigen_centrality(dt_graph2))$vector)
proc_s1_eigen_centrality <- as.matrix((eigen_centrality(proc_s1_graph2))$vector)
proc_s3_eigen_centrality <- as.matrix((eigen_centrality(proc_s3_graph2))$vector)
```

```{r}
# Testing based on Wasserstein Distance:
spec.output <- c("pval","d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_eigen_centrality, proc_s1_eigen_centrality)[spec.output]
wasserstein.test(dt_eigen_centrality, proc_s3_eigen_centrality)[spec.output]
```

## Page Rank:

```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s1_graph2<-igraph::simplify(proc_s1_graph, remove.multiple = TRUE, remove.loops = FALSE)
proc_s3_graph2<-igraph::simplify(proc_s3_graph, remove.multiple = TRUE, remove.loops = FALSE)
```

```{r}
dt_page_rank <- as.matrix((page.rank(dt_graph2))$vector)
proc_s1_page_rank <- as.matrix((page.rank(proc_s1_graph2))$vector)
proc_s3_page_rank <- as.matrix((page.rank(proc_s3_graph2))$vector)
```

```{r}
# Testing based on Wasserstein Distance:
spec.output <- c("pval","d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_page_rank, proc_s1_page_rank)[spec.output]
wasserstein.test(dt_page_rank, proc_s3_page_rank)[spec.output]
```

# Closeness:

```{r}
dt_graph2<-igraph::simplify(dt_graph, remove.multiple = FALSE, remove.loops = FALSE)
proc_s1_graph2<-igraph::simplify(proc_s1_graph2, remove.multiple = FALSE, remove.loops = FALSE)
proc_s3_graph2<-igraph::simplify(proc_s3_graph2, remove.multiple = FALSE, remove.loops = FALSE)
```

```{r}
dt_closeness <- as.matrix(closeness(dt_graph2))
proc_s1_graph2_closeness <- as.matrix(closeness(proc_s1_graph2))
proc_s3_graph2_closeness <- as.matrix(closeness(proc_s3_graph2))
```

```{r}
# Testing based on Wasserstein Distance:
spec.output <- c("pval", "d.wass", "d.wass^2", "perc.loc", "perc.size", "perc.shape")
wasserstein.test(dt_closeness, proc_s1_graph2_closeness)[spec.output]
wasserstein.test(dt_closeness, proc_s3_graph2_closeness)[spec.output]
```

## Travel Channel for Reduced Network1:

```{r}
s1 <- data.table::fread(here::here("dataQ3","FinalGraphs", "dfProcSeed1-Graph2FullyReduced.csv"))
s1_6 <- s1 %>% filter(eType == 6)

head(s1_6)

```

```{r}
target_count <- count(s1_6, 'Target')
target_count
```
```{r}
target1 <- s1_6 %>% filter(Target==499467)
target2 <- s1_6 %>% filter(Target==509607)
target3 <- s1_6 %>% filter(Target==561157)
target4 <- s1_6 %>% filter(Target==616453)
target5 <- s1_6 %>% filter(Target==625756)
target6 <- s1_6 %>% filter(Target==657173)

```

```{r}
ggplot(target1, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed1 Travel Channel Analysis based on Target 499467",
                                    x="Time", y = "Source")
ggplot(target2, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed1 Travel Channel Analysis based on Target 509607",
                                    x="Time", y = "Source")
ggplot(target3, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed1 Travel Channel Analysis based on Target 561157",
                                    x="Time", y = "Source")
ggplot(target4, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed1 Travel Channel Analysis based on Target 616453",
                                    x="Time", y = "Source")
ggplot(target5, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed1 Travel Channel Analysis based on Target 625756",
                                    x="Time", y = "Source")
ggplot(target6, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed1 Travel Channel Analysis based on Target 657173",
                                    x="Time", y = "Source")
```

# Reduced Network2:

```{r}
s3 <- data.table::fread(here::here("dataQ3","FinalGraphs", "dfProcSeed3-Graph2FullyReduced.csv"))
s3_6 <- s3 %>% filter(eType == 6)

head(s3_6)
```

```{r}
target_count <- count(s3_6, 'Target')
target_count

```

```{r}
target1 <- s3_6 %>% filter(Target==499467)
target2 <- s3_6 %>% filter(Target==509607)
target3 <- s3_6 %>% filter(Target==561157)
target4 <- s3_6 %>% filter(Target==616453)
target5 <- s3_6 %>% filter(Target==625756)
target6 <- s3_6 %>% filter(Target==657173)
```

```{r}
ggplot(target1, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed3 Travel Channel Analysis based on Target 499467",
                                    x="Time", y = "Source")
ggplot(target2, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed3 Travel Channel Analysis based on Target 509607",
                                    x="Time", y = "Source")
ggplot(target3, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed3 Travel Channel Analysis based on Target 561157",
                                    x="Time", y = "Source")
ggplot(target4, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed3 Travel Channel Analysis based on Target 616453",
                                    x="Time", y = "Source")
ggplot(target5, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed3 Travel Channel Analysis based on Target 625756",
                                    x="Time", y = "Source")
ggplot(target6, aes(x=Time/86400, y=as.character(Source), color = as.character(SourceLocation), fill=as.character(SourceLocation))) + 
  geom_point(shape=23, size = 5)+labs(title="ReducedSeed3 Travel Channel Analysis based on Target 657173",
                                    x="Time", y = "Source")
```










