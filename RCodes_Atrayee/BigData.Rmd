---
title: "BigData-Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
library(plyr)
```

## Procurement Channel:

```{r cars}
# Load The Data:
bg23 <- data.table::fread(here::here("data", "BigGraphData", "procurement.csv"))

nrow(bg23)

head(bg23)
length(unique(bg23$Target))
length(unique(bg23$Source))

```



```{r}
#unique(bg23$Source) 
#unique(bg23$Target)

bg23[bg23$Target==641131 & bg23$eType == 2]

bg23$Time[bg23$Target==641131]

bg2 <- bg23 %>% filter(bg23$eType==2)
bg3 <- bg23 %>% filter(bg23$eType==3)

```

```{r}
items_sold <- count(bg2, c("Source","Target")) # Trying to find interesting items which were sold multiple times.
items_bought <- count(bg3, c("Source","Target")) # Trying to find interesting items which were bought multiple times.
# We need items which are sold and bought more than 7 times by the same people.

max(items_sold$freq)
min(items_sold$freq)
max(items_bought$freq)
min(items_bought$freq)
unique(items_sold$freq)

items_sold <- items_sold %>% filter(items_sold$freq >= 7)
items_bought <- items_bought %>% filter(items_bought$freq >= 7)

```

```{r}
## Items which are both sold and bought more than 7 times:
frequent_items<-intersect(items_sold$Target, items_bought$Target)
```








```{r}
## Extracting the rows for which Targets belong to the list of common items which were both sold and bought:
transactions <- bg23 %>% filter(bg23$Target==frequent_items)
length(unique(transactions$Target))
head(transactions)
tail(transactions)

time <- count(transactions, "Time")
max(time$freq)
which(time$freq == 2) #1604,1630,2108
time[2108,] #5937629,8915196,11505651

transactions$Target[transactions$Time==5937629] #547205,552748
transactions$Target[transactions$Time==8915196] #554011,560703
transactions$Target[transactions$Time==11505651] #492039,469675

transactions$Source[transactions$Time==5937629] #547205,552748
transactions$Source[transactions$Time==8915196] #554011,560703
transactions$Source[transactions$Time==11505651] #492039,469675


```



```{r}
multi_sources <- count(transactions, c("Target","Time"))
max(multi_sources$freq)
unique(multi_sources$freq)

#multi_sources <- multi_sources %>% filter(multi_sources$freq >=7)
nrow(multi_sources)

multi_sources

```

```{r}
hackers <- bg23 %>% filter(bg23$Source==multi_sources$Source, bg23$Target==multi_sources$Target)
count(hackers, "Time")

```



```{r}
ggplot(hackers, aes(x=as.character(Source), y=Time, color = as.character(eType), fill=as.character(eType))) + 
  geom_point(shape=23, size = 5)+theme(axis.text.x=element_text(size=10, angle=90))+labs(title="Source Target Combinations for Big Graph ",
                                    x="Source & Target Combination", y = "Time")
```

## Clustering:

```{r}
install.packages("klaR")
library(klaR)
```



